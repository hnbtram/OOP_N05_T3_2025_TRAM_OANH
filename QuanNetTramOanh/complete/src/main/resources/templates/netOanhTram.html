<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quán Net Trâm Oanh - Hệ thống quản lý Cyber Game</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #f0f2f5;
            --card-bg-color: #ffffff;
            --primary-color: #3498db;
            --secondary-color: #e67e22;
            --text-dark: #34495e;
            --text-muted: #7f8c8d;
            --border-color: rgba(0, 0, 0, 0.1);
        }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-dark);
            font-family: 'Poppins', sans-serif;
        }

        .container-fluid {
            padding-top: 30px;
        }

        .header-logo {
            font-size: 2.8rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .header-logo i {
            color: var(--primary-color);
            margin-right: 15px;
        }

        .tab-content {
            background-color: var(--card-bg-color);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
            min-height: 80vh;
        }

        .nav-tabs {
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 30px;
        }
        .nav-tabs .nav-link {
            color: var(--text-muted);
            font-weight: 600;
            border: none;
            border-bottom: 3px solid transparent;
            margin-bottom: -2px;
            transition: color 0.3s, border-bottom 0.3s;
        }
        .nav-tabs .nav-link:hover {
            color: var(--primary-color);
        }
        .nav-tabs .nav-link.active {
            color: var(--primary-color);
            background-color: transparent;
            border-bottom-color: var(--primary-color);
        }

        .card {
            background-color: var(--card-bg-color);
            border: 1px solid var(--border-color);
            color: var(--text-dark);
        }

        .form-control, .form-select {
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            color: var(--text-dark);
        }
        .form-control:focus, .form-select:focus {
            background-color: var(--bg-color);
            border-color: var(--primary-color);
            color: var(--text-dark);
            box-shadow: 0 0 0 0.25rem rgba(52, 152, 219, 0.25);
        }
        .form-control::placeholder {
            color: var(--text-muted);
        }

        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        .btn-primary:hover {
            background-color: #2980b9;
            border-color: #2980b9;
        }
        .btn-danger {
            background-color: #c0392b;
            border-color: #c0392b;
        }
        .btn-danger:hover {
            background-color: #a93222;
            border-color: #a93222;
        }
        .btn-warning {
            background-color: #f39c12;
            border-color: #f39c12;
            color: var(--dark-color);
        }
        .btn-warning:hover {
            background-color: #e08e0b;
            border-color: #e08e0b;
        }
        .btn-secondary {
            background-color: #bdc3c7;
            border-color: #bdc3c7;
            color: var(--text-dark);
        }
        .btn-secondary:hover {
            background-color: #a9b5b9;
            border-color: #a9b5b9;
        }

        .table {
            color: var(--text-dark);
        }
        .table > :not(caption) > * > * {
            border-bottom-color: var(--border-color);
        }
        .table-striped > tbody > tr:nth-of-type(odd) > * {
            background-color: #f8f9fa;
        }
        
        .computer-card {
            background-color: var(--card-bg-color);
            border-radius: 10px;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            border: 1px solid var(--border-color);
            overflow: hidden;
            position: relative;
        }
        .computer-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        .computer-card.status-free .card-header { background-color: #ffffff; }
        .computer-card.status-active .card-header { background-color: #27ae60; color: white; }
        .computer-card.status-maintenance .card-header { background-color: #f1c40f; color: var(--text-dark); }
        .computer-card.status-broken .card-header { background-color: #e74c3c; color: white; }

        .status-badge.bg-success { background-color: #2ecc71 !important; }
        .status-badge.bg-secondary { background-color: #7f8c8d !important; }
        .status-badge.bg-warning { background-color: #f1c40f !important; }
        .status-badge.bg-danger { background-color: #e74c3c !important; }
        .status-badge {
            font-size: 0.8rem;
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: 700;
        }
        
        .modal-content {
            background-color: var(--card-bg-color);
            color: var(--text-dark);
        }
        .modal-header {
            border-bottom: 1px solid var(--border-color);
        }
        .modal-footer {
            border-top: 1px solid var(--border-color);
        }
        .btn-close {
            filter: none;
        }

        /* Payment method buttons */
        .payment-methods button {
            border: 1px solid var(--border-color);
            background-color: var(--bg-color);
            color: var(--text-dark);
            transition: all 0.2s ease-in-out;
        }
        .payment-methods button.active {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }
        .payment-methods button:hover {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }
        .computer-card.status-free .card-header {
            background-color: var(--card-bg-color);
            color: var(--text-dark);
        }
        .computer-card.status-free .card-header .badge {
            background-color: var(--primary-color) !important;
        }

        /* NEW Customer Card Styles */
        .customer-card-item {
            background-color: var(--card-bg-color);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s;
        }
        .customer-card-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        }
        .customer-info-row {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            color: var(--text-dark);
        }
        .customer-info-row i {
            width: 25px;
            color: var(--primary-color);
        }
        .customer-card-footer {
            border-top: 1px solid var(--border-color);
            padding-top: 15px;
            margin-top: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .customer-card-footer .btn {
            font-size: 0.9rem;
        }
        .customer-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>

<div class="container-fluid">
    <div class="text-center header-logo">
        <i class="fas fa-satellite-dish"></i>Quán Net Trâm Oanh
    </div>
    
    <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
            <a class="nav-link active" id="booking-tab" data-bs-toggle="tab" data-bs-target="#booking" type="button" role="tab">
                <i class="fas fa-desktop me-2"></i>Dashboard
            </a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link" id="customer-tab" data-bs-toggle="tab" data-bs-target="#customer" type="button" role="tab">
                <i class="fas fa-users me-2"></i>Khách hàng
            </a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link" id="computer-tab" data-bs-toggle="tab" data-bs-target="#computer" type="button" role="tab">
                <i class="fas fa-server me-2"></i>Máy tính
            </a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link" id="service-tab" data-bs-toggle="tab" data-bs-target="#service" type="button" role="tab">
                <i class="fas fa-utensils me-2"></i>Dịch vụ
            </a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link" id="history-tab" data-bs-toggle="tab" data-bs-target="#history" type="button" role="tab">
                <i class="fas fa-history me-2"></i>Lịch sử
            </a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link" id="statistics-tab" data-bs-toggle="tab" data-bs-target="#statistics" type="button" role="tab">
                <i class="fas fa-chart-line me-2"></i>Thống kê
            </a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link" id="games-tab" data-bs-toggle="tab" data-bs-target="#games" type="button" role="tab">
                <i class="fas fa-gamepad me-2"></i>Games
            </a>
        </li>
    </ul>

    <div class="tab-content" id="myTabContent">

        <div class="tab-pane fade show active" id="booking" role="tabpanel">
            <div class="row">
                <div class="col-md-4">
                    <div class="card p-3 mb-3 shadow-sm">
                        <h5 class="card-title text-primary"><i class="fas fa-edit me-2"></i>Thông tin đặt chỗ</h5>
                        <form id="bookingForm">
                            <div class="mb-3">
                                <label for="fullName" class="form-label">Tên khách hàng</label>
                                <input type="text" class="form-control" id="fullName" placeholder="Nhập tên khách hàng" required>
                            </div>
                            <div class="mb-3">
                                <label for="phone" class="form-label">Số điện thoại</label>
                                <input type="tel" class="form-control" id="phone" placeholder="Nhập SĐT khách hàng" pattern="^(0?)(3[2-9]|5[6|8|9]|7[0|6-9]|8[0-6|8|9]|9[0-4|6-9])[0-9]{7}$" required>
                            </div>
                        </form>
                        
                        <h5 class="card-title mt-4 text-primary"><i class="fas fa-utensils me-2"></i>Dịch vụ</h5>
                        <div id="serviceQuantities">
                            </div>
                        
                        <hr class="text-muted">
        
                        <div class="d-grid gap-2">
                            <button class="btn btn-primary" type="button" onclick="startSession()">
                                Bắt đầu phiên mới
                            </button>
                            <button class="btn btn-secondary" type="button" onclick="resetBookingForm()">
                                Đặt lại
                            </button>
                        </div>
                    </div>
                </div>
        
                <div class="col-md-8">
                    <h4 class="mb-3">
                        <i class="fas fa-desktop me-2 text-primary"></i>Quản lý máy tính
                        <small class="text-muted ms-2">(Chọn máy để bắt đầu phiên)</small>
                    </h4>
                    <div id="computersDashboard" class="row">
                        </div>
                </div>
            </div>
        </div>
        
        <div class="tab-pane fade" id="customer" role="tabpanel">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3 class="mb-0">Danh sách khách hàng</h3>
                <div class="input-group w-50">
                    <input type="text" class="form-control" id="customerSearchInput" placeholder="Tìm kiếm theo tên hoặc SĐT..." onkeyup="filterCustomers()">
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addCustomerModal">
                        <i class="fas fa-plus me-2"></i>Thêm
                    </button>
                </div>
            </div>
            
            <div id="customerList" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                </div>
            </div>
        
        <div class="tab-pane fade" id="computer" role="tabpanel">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3 class="mb-0">Danh sách máy tính</h3>
                <div>
                    <select id="computerStatusFilter" class="form-select d-inline-block w-auto me-2" onchange="filterComputers()">
                        <option value="all">Tất cả trạng thái</option>
                        <option value="free">Trống</option>
                        <option value="active">Đang hoạt động</option>
                        <option value="maintenance">Bảo trì</option>
                        <option value="broken">Hỏng</option>
                    </select>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addComputerModal">
                        <i class="fas fa-plus me-2"></i>Thêm
                    </button>
                </div>
            </div>
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Tên máy</th>
                        <th>Giá/giờ</th>
                        <th>Trạng thái</th>
                        <th>Khách hàng</th>
                        <th>Thời gian bắt đầu</th>
                        <th>Thao tác</th>
                    </tr>
                </thead>
                <tbody id="computerTable">
                    </tbody>
            </table>
        </div>
        
        <div class="tab-pane fade" id="service" role="tabpanel">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3 class="mb-0">Danh sách dịch vụ</h3>
                <div class="input-group w-50">
                    <input type="text" class="form-control" id="serviceSearchInput" placeholder="Tìm kiếm dịch vụ..." onkeyup="filterServices()">
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addServiceModal">
                        <i class="fas fa-plus me-2"></i>Thêm
                    </button>
                </div>
            </div>
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Tên dịch vụ</th>
                        <th>Giá</th>
                        <th>Trạng thái</th>
                        <th>Thao tác</th>
                    </tr>
                </thead>
                <tbody id="serviceTable">
                    </tbody>
            </table>
        </div>
        
        <div class="tab-pane fade" id="history" role="tabpanel">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3 class="mb-0">Lịch sử giao dịch</h3>
                <div class="input-group w-50">
                    <input type="date" class="form-control me-2" id="historyDateFilter" onchange="filterHistory()">
                    <input type="text" class="form-control" id="historySearchInput" placeholder="Tìm kiếm theo ID hoặc Tên khách hàng..." onkeyup="filterHistory()">
                </div>
            </div>
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Mã giao dịch</th>
                        <th>Ngày</th>
                        <th>Khách hàng</th>
                        <th>Máy tính</th>
                        <th>Tổng tiền</th>
                        <th>Hình thức TT</th>
                        <th>Chi tiết</th>
                    </tr>
                </thead>
                <tbody id="historyTable">
                    </tbody>
            </table>
        </div>
        
        <div class="tab-pane fade" id="statistics" role="tabpanel">
            <h3 class="text-center mb-4"><i class="fas fa-chart-bar me-2"></i>Thống kê kinh doanh</h3>
            <div class="row">
                <div class="col-md-3">
                    <div class="card text-white bg-primary mb-3">
                        <div class="card-body">
                            <h5 class="card-title">Tổng doanh thu</h5>
                            <p class="card-text fs-4" id="totalRevenue">0đ</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-white bg-success mb-3">
                        <div class="card-body">
                            <h5 class="card-title">Tổng khách hàng</h5>
                            <p class="card-text fs-4" id="totalCustomers">0</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-white bg-info mb-3">
                        <div class="card-body">
                            <h5 class="card-title">Máy đang hoạt động</h5>
                            <p class="card-text fs-4" id="activeComputers">0/0</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-white bg-warning mb-3">
                        <div class="card-body">
                            <h5 class="card-title">Dịch vụ được mua nhiều nhất</h5>
                            <p class="card-text fs-4" id="mostPopularService">---</p>
                        </div>
                    </div>
                </div>
            </div>
        
            <div class="card mt-4">
                <div class="card-body">
                    <h5 class="card-title">Doanh thu theo tháng</h5>
                    <div id="monthlyRevenueChart" class="d-flex justify-content-around align-items-end mt-4" style="height: 250px;">
                        </div>
                </div>
            </div>
        </div>
        
        <div class="tab-pane fade" id="games" role="tabpanel">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3 class="mb-0">Games & Phần mềm</h3>
                <div>
                    <select id="gameSoftwareFilter" class="form-select d-inline-block w-auto me-2" onchange="filterGames()">
                        <option value="all">Tất cả</option>
                        <option value="game">Game</option>
                        <option value="software">Phần mềm</option>
                    </select>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addGameModal">
                        <i class="fas fa-plus me-2"></i>Thêm
                    </button>
                </div>
            </div>
        
            <div class="row">
                <div class="col-md-6">
                    <h5 class="mt-3">Games</h5>
                    <ul class="list-group" id="gameList">
                    </ul>
                </div>
                <div class="col-md-6">
                    <h5 class="mt-3">Phần mềm</h5>
                    <ul class="list-group" id="softwareList">
                    </ul>
                </div>
            </div>
        </div>

    </div>
</div>

<div class="modal fade" id="addCustomerModal" tabindex="-1" aria-labelledby="addCustomerModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addCustomerModalLabel">Thêm khách hàng mới</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="newCustomerForm" onsubmit="addCustomer(event)">
                    <div class="mb-3">
                        <label for="newCustomerName" class="form-label">Tên khách hàng</label>
                        <input type="text" class="form-control" id="newCustomerName" required>
                    </div>
                    <div class="mb-3">
                        <label for="newCustomerPhone" class="form-label">Số điện thoại</label>
                        <input type="tel" class="form-control" id="newCustomerPhone" pattern="^(0?)(3[2-9]|5[6|8|9]|7[0|6-9]|8[0-6|8|9]|9[0-4|6-9])[0-9]{7}$" required>
                    </div>
                    <div class="mb-3">
                        <label for="newCustomerEmail" class="form-label">Email</label>
                        <input type="email" class="form-control" id="newCustomerEmail">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                        <button type="submit" class="btn btn-primary">Lưu</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="editCustomerModal" tabindex="-1" aria-labelledby="editCustomerModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editCustomerModalLabel">Sửa thông tin khách hàng</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editCustomerForm" onsubmit="updateCustomer(event)">
                    <div class="mb-3">
                        <label for="editCustomerId" class="form-label">ID</label>
                        <input type="text" class="form-control" id="editCustomerId" readonly>
                    </div>
                    <div class="mb-3">
                        <label for="editCustomerName" class="form-label">Tên khách hàng</label>
                        <input type="text" class="form-control" id="editCustomerName" required>
                    </div>
                    <div class="mb-3">
                        <label for="editCustomerPhone" class="form-label">Số điện thoại</label>
                        <input type="tel" class="form-control" id="editCustomerPhone" pattern="^(0?)(3[2-9]|5[6|8|9]|7[0|6-9]|8[0-6|8|9]|9[0-4|6-9])[0-9]{7}$" required>
                    </div>
                    <div class="mb-3">
                        <label for="editCustomerEmail" class="form-label">Email</label>
                        <input type="email" class="form-control" id="editCustomerEmail">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                        <button type="submit" class="btn btn-primary">Cập nhật</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="addComputerModal" tabindex="-1" aria-labelledby="addComputerModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addComputerModalLabel">Thêm máy tính mới</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="newComputerForm" onsubmit="addComputer(event)">
                    <div class="mb-3">
                        <label for="newComputerName" class="form-label">Tên máy</label>
                        <input type="text" class="form-control" id="newComputerName" required>
                    </div>
                    <div class="mb-3">
                        <label for="newComputerPrice" class="form-label">Giá/giờ</label>
                        <input type="number" class="form-control" id="newComputerPrice" min="0" required>
                    </div>
                    <div class="mb-3">
                        <label for="newComputerStatus" class="form-label">Trạng thái</label>
                        <select class="form-select" id="newComputerStatus" required>
                            <option value="free">Trống</option>
                            <option value="active">Đang hoạt động</option>
                            <option value="maintenance">Bảo trì</option>
                            <option value="broken">Hỏng</option>
                        </select>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                        <button type="submit" class="btn btn-primary">Lưu</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="editComputerModal" tabindex="-1" aria-labelledby="editComputerModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editComputerModalLabel">Sửa thông tin máy tính</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editComputerForm" onsubmit="updateComputer(event)">
                    <div class="mb-3">
                        <label for="editComputerId" class="form-label">ID</label>
                        <input type="text" class="form-control" id="editComputerId" readonly>
                    </div>
                    <div class="mb-3">
                        <label for="editComputerName" class="form-label">Tên máy</label>
                        <input type="text" class="form-control" id="editComputerName" required>
                    </div>
                    <div class="mb-3">
                        <label for="editComputerPrice" class="form-label">Giá/giờ</label>
                        <input type="number" class="form-control" id="editComputerPrice" required>
                    </div>
                    <div class="mb-3">
                        <label for="editComputerStatus" class="form-label">Trạng thái</label>
                        <select class="form-select" id="editComputerStatus" required>
                            <option value="free">Trống</option>
                            <option value="active">Đang hoạt động</option>
                            <option value="maintenance">Bảo trì</option>
                            <option value="broken">Hỏng</option>
                        </select>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                        <button type="submit" class="btn btn-primary">Cập nhật</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="addServiceModal" tabindex="-1" aria-labelledby="addServiceModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addServiceModalLabel">Thêm dịch vụ mới</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="newServiceForm" onsubmit="addService(event)">
                    <div class="mb-3">
                        <label for="newServiceName" class="form-label">Tên dịch vụ</label>
                        <input type="text" class="form-control" id="newServiceName" required>
                    </div>
                    <div class="mb-3">
                        <label for="newServicePrice" class="form-label">Giá</label>
                        <input type="number" class="form-control" id="newServicePrice" min="0" required>
                    </div>
                    <div class="mb-3">
                        <label for="newServiceStatus" class="form-label">Trạng thái</label>
                        <select class="form-select" id="newServiceStatus" required>
                            <option value="active">Hoạt động</option>
                            <option value="inactive">Ngừng bán</option>
                        </select>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                        <button type="submit" class="btn btn-primary">Lưu</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="editServiceModal" tabindex="-1" aria-labelledby="editServiceModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editServiceModalLabel">Sửa thông tin dịch vụ</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editServiceForm" onsubmit="updateService(event)">
                    <div class="mb-3">
                        <label for="editServiceId" class="form-label">ID</label>
                        <input type="text" class="form-control" id="editServiceId" readonly>
                    </div>
                    <div class="mb-3">
                        <label for="editServiceName" class="form-label">Tên dịch vụ</label>
                        <input type="text" class="form-control" id="editServiceName" required>
                    </div>
                    <div class="mb-3">
                        <label for="editServicePrice" class="form-label">Giá</label>
                        <input type="number" class="form-control" id="editServicePrice" required>
                    </div>
                    <div class="mb-3">
                        <label for="editServiceStatus" class="form-label">Trạng thái</label>
                        <select class="form-select" id="editServiceStatus" required>
                            <option value="active">Hoạt động</option>
                            <option value="inactive">Ngừng bán</option>
                        </select>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                        <button type="submit" class="btn btn-primary">Cập nhật</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="viewTransactionModal" tabindex="-1" aria-labelledby="viewTransactionModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="viewTransactionModalLabel">Chi tiết giao dịch</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="receiptModalBody">
                <div class="receipt-header text-center mb-4">
                    <h3>HÓA ĐƠN THANH TOÁN</h3>
                    <p>Mã giao dịch: <strong id="viewTransactionId"></strong></p>
                </div>
                <div class="receipt-info">
                    <p>Khách hàng: <span id="viewTransactionCustomer"></span></p>
                    <p>Số điện thoại: <span id="viewTransactionPhone"></span></p>
                    <p>Ngày: <span id="viewTransactionDate"></span></p>
                </div>
                <hr>
                <h6>Chi tiết sử dụng máy</h6>
                <p>Máy tính: <span id="viewTransactionComputer"></span></p>
                <p>Thời gian: <span id="viewTransactionTime"></span></p>
                <p>Tổng thời gian: <span id="viewTransactionDuration"></span></p>
                <hr>
                <h6>Dịch vụ sử dụng</h6>
                <div id="viewTransactionServices"></div>
                <hr>
                <div class="text-end">
                    <p>Tổng phụ: <span id="viewTransactionSubtotal"></span></p>
                    <p>Giảm giá: <span id="viewTransactionPromo"></span></p>
                    <h5 class="mt-3">Tổng cộng: <strong id="viewTransactionTotal"></strong></h5>
                    <p>Hình thức TT: <span id="viewTransactionPaymentMethod"></span></p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                <button type="button" class="btn btn-primary" id="printTransactionBtn">
                    <i class="fas fa-print me-2"></i>In hóa đơn
                </button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="addGameModal" tabindex="-1" aria-labelledby="addGameModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addGameModalLabel">Thêm Game/Phần mềm mới</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="newGameForm" onsubmit="addGame(event)">
                    <div class="mb-3">
                        <label for="newGameName" class="form-label">Tên</label>
                        <input type="text" class="form-control" id="newGameName" required>
                    </div>
                    <div class="mb-3">
                        <label for="newGameType" class="form-label">Loại</label>
                        <select class="form-select" id="newGameType" required>
                            <option value="game">Game</option>
                            <option value="software">Phần mềm</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="newGameCategory" class="form-label">Thể loại</label>
                        <input type="text" class="form-control" id="newGameCategory">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                        <button type="submit" class="btn btn-primary">Lưu</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="checkoutModal" tabindex="-1" aria-labelledby="checkoutModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="checkoutModalLabel">Thanh toán</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <h6 class="text-primary">Máy tính: <span id="checkoutComputerName"></span></h6>
                <p>Khách hàng: <span id="checkoutCustomerName"></span></p>
                <hr class="text-muted">
                <h6>Chi tiết</h6>
                <p>Thời gian bắt đầu: <span id="checkoutStartTime"></span></p>
                <p>Thời gian kết thúc: <span id="checkoutEndTime"></span></p>
                <p>Tổng thời gian: <span id="checkoutDuration"></span></p>
                <p>Chi phí máy: <span id="checkoutComputerCost"></span></p>
                <p>Chi phí dịch vụ: <span id="checkoutServicesCost"></span></p>
                <hr class="text-muted">
                <h5 class="text-end">Tổng cộng: <strong id="checkoutTotal"></strong></h5>
                <hr class="text-muted">
                <h6>Hình thức thanh toán</h6>
                <div class="d-flex justify-content-around payment-methods" role="group">
                    <button type="button" class="btn w-50 me-2" id="cashBtn" onclick="selectPaymentMethod('Tiền mặt')">
                        <i class="fas fa-money-bill-wave me-2"></i>Tiền mặt
                    </button>
                    <button type="button" class="btn w-50" id="transferBtn" onclick="selectPaymentMethod('Chuyển khoản')">
                        <i class="fas fa-qrcode me-2"></i>Chuyển khoản
                    </button>
                </div>
                
                <div id="cashPaymentDetails" class="mt-3" style="display: none;">
                    <div class="mb-3">
                        <label for="cashGiven" class="form-label">Số tiền khách đưa</label>
                        <input type="number" class="form-control" id="cashGiven" min="0" oninput="calculateChange()">
                    </div>
                    <div class="text-end">
                        <h5 class="text-success">Tiền thừa: <strong id="cashChange">0đ</strong></h5>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-primary" onclick="endSessionAndSave()">Thanh toán</button>
            </div>
        </div>
    </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Dữ liệu mẫu ban đầu, sẽ chỉ được sử dụng nếu chưa có dữ liệu nào được lưu trữ
    const initialCustomers = [
        { id: 'KH001', name: 'Nguyễn Văn A', phone: '0909123456', email: '', lastVisit: '2023-07-20', totalSpent: 0 },
        { id: 'KH002', name: 'Trần Thị B', phone: '0918123456', email: 'tranthiB@gmail.com', lastVisit: '2023-07-18', totalSpent: 0 },
        { id: 'KH003', name: 'Lê Văn C', phone: '0987123456', email: '', lastVisit: '2023-07-15', totalSpent: 0 }
    ];

    let customers = [];
    
    // Hàm tải dữ liệu khách hàng từ localStorage
    function loadCustomersFromLocalStorage() {
        const storedCustomers = localStorage.getItem('customers');
        if (storedCustomers) {
            customers = JSON.parse(storedCustomers);
        } else {
            customers = initialCustomers;
        }
    }

    // Hàm lưu dữ liệu khách hàng vào localStorage
    function saveCustomersToLocalStorage() {
        localStorage.setItem('customers', JSON.stringify(customers));
    }


    // Dữ liệu mẫu (Đã cập nhật để liên kết máy tính với khách hàng và thời gian)
    let computers = [
        { id: 'MAY001', name: 'Máy 1', price: 15000, status: 'active', customer: 'Nguyễn Văn A', startTime: new Date('2025-08-14T10:00:00'), servicesUsed: [{id: 'DV001', quantity: 1}]},
        { id: 'MAY002', name: 'Máy 2', price: 20000, status: 'active', customer: 'Trần Thị B', startTime: new Date('2025-08-14T15:00:00'), servicesUsed: [{id: 'DV002', quantity: 1}]},
        { id: 'MAY003', name: 'Máy VIP', price: 30000, status: 'free', customer: '', startTime: null, servicesUsed: []},
        { id: 'MAY004', name: 'Máy 3', price: 15000, status: 'maintenance', customer: '', startTime: null, servicesUsed: []},
        { id: 'MAY005', name: 'Máy 4', price: 20000, status: 'broken', customer: '', startTime: null, servicesUsed: []}
    ];

    let services = [
        { id: 'DV001', name: 'Nước suối', price: 10000, status: 'active' },
        { id: 'DV002', name: 'Nước ngọt', price: 15000, status: 'active' },
        { id: 'DV003', name: 'Bánh snack', price: 20000, status: 'active' },
        { id: 'DV004', name: 'Mì gói', price: 25000, status: 'inactive' }
    ];

    let transactions = [
        { id: 'GD001', customerId: 'KH001', customerName: 'Nguyễn Văn A', phone: '0909123456', computer: 'Máy VIP - 30.000đ/giờ', startTime: new Date('2025-08-14T10:00:00'), endTime: new Date('2025-08-14T12:30:00'), services: [{name: 'Nước suối', price: 10000, quantity: 1, total: 10000}, {name: 'Bánh snack', price: 20000, quantity: 1, total: 20000}], subtotal: 125000, promo: 0, total: 125000, paymentMethod: 'Tiền mặt' },
        { id: 'GD002', customerId: 'KH002', customerName: 'Trần Thị B', phone: '0918123456', computer: 'Máy 2 - 20.000đ/giờ', startTime: new Date('2025-08-14T15:00:00'), endTime: new Date('2025-08-14T16:30:00'), services: [{name: 'Nước ngọt', price: 15000, quantity: 1, total: 15000}], subtotal: 45000, promo: 0, total: 45000, paymentMethod: 'Chuyển khoản' },
        { id: 'GD003', customerId: 'KH001', customerName: 'Nguyễn Văn A', phone: '0909123456', computer: 'Máy 1 - 15.000đ/giờ', startTime: new Date('2025-07-14T08:00:00'), endTime: new Date('2025-07-14T09:00:00'), services: [], subtotal: 15000, promo: 0, total: 15000, paymentMethod: 'Tiền mặt' },
        { id: 'GD004', customerId: 'KH002', customerName: 'Trần Thị B', phone: '0918123456', computer: 'Máy 2 - 20.000đ/giờ', startTime: new Date('2025-06-14T18:00:00'), endTime: new Date('2025-06-14T19:00:00'), services: [], subtotal: 20000, promo: 0, total: 20000, paymentMethod: 'Tiền mặt' }
    ];

    let games = [
        { id: 'GAME001', name: 'Liên Minh Huyền Thoại', category: 'MOBA', type: 'game' },
        { id: 'GAME002', name: 'Valorant', category: 'FPS', type: 'game' },
        { id: 'GAME003', name: 'Word', category: 'Văn phòng', type: 'software' }
    ];

    let editingCustomerId = '';
    let editingComputerId = '';
    let editingServiceId = '';
    let currentComputerId = ''; 
    let selectedPaymentMethod = 'Tiền mặt'; // Mặc định là Tiền mặt
    let currentTotal = 0;

    // Hàm định dạng tiền tệ
    const formatCurrency = (value) => {
        return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(value);
    };

    // Hàm tính thời gian đã sử dụng
    const formatDuration = (start, end) => {
        if (!start || !end) return '---';
        const durationInMinutes = (end - start) / (1000 * 60);
        const hours = Math.floor(durationInMinutes / 60);
        const minutes = Math.round(durationInMinutes % 60);
        return `${hours} giờ ${minutes} phút`;
    };

    // --- RENDER FUNCTIONS ---
    
    function calculateAllCustomerTotalSpent() {
        customers.forEach(customer => {
            let total = 0;
            transactions.forEach(transaction => {
                if (transaction.customerId === customer.id) {
                    total += transaction.total;
                }
            });
            customer.totalSpent = total;
        });
    }

    // Render Booking Dashboard - Updated
    function renderBookingDashboard() {
        const dashboard = document.getElementById('computersDashboard');
        dashboard.innerHTML = '';
        
        computers.forEach(computer => {
            let statusIconClass = '';
            let actionButton = '';
            let cardClass = '';
            let statusText = '';

            switch(computer.status) {
                case 'active':
                    statusIconClass = 'fas fa-hourglass-half text-white';
                    actionButton = `<button class="btn btn-danger btn-sm w-100" onclick="showCheckoutModal('${computer.id}')"><i class="fas fa-stop me-2"></i>Kết thúc phiên</button>`;
                    cardClass = 'status-active';
                    statusText = 'Đang hoạt động';
                    break;
                case 'maintenance':
                    statusIconClass = 'fas fa-tools text-dark';
                    actionButton = `<button class="btn btn-secondary btn-sm w-100" disabled><i class="fas fa-tools me-2"></i>Đang bảo trì</button>`;
                    cardClass = 'status-maintenance';
                    statusText = 'Bảo trì';
                    break;
                case 'broken':
                    statusIconClass = 'fas fa-exclamation-triangle text-white';
                    actionButton = `<button class="btn btn-secondary btn-sm w-100" disabled><i class="fas fa-times me-2"></i>Hỏng</button>`;
                    cardClass = 'status-broken';
                    statusText = 'Hỏng';
                    break;
                case 'free':
                default:
                    statusIconClass = 'fas fa-power-off text-muted';
                    actionButton = `<button class="btn btn-primary btn-sm w-100" onclick="selectComputerForSession('${computer.id}')"><i class="fas fa-play me-2"></i>Bắt đầu phiên</button>`;
                    cardClass = 'status-free';
                    statusText = 'Trống';
                    break;
            }

            const card = document.createElement('div');
            card.className = 'col-lg-4 col-md-6 col-sm-12 mb-4';
            card.innerHTML = `
                <div class="card h-100 computer-card shadow-sm ${cardClass}">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0 ${computer.status === 'free' ? '' : 'text-white'}">${computer.name}</h5>
                        <span class="badge status-badge bg-primary">${formatCurrency(computer.price)}/giờ</span>
                    </div>
                    <div class="card-body d-flex flex-column">
                        <div class="text-center mb-3">
                            <i class="${statusIconClass}" style="font-size: 3rem;"></i>
                        </div>
                        <p class="card-text">Trạng thái: <strong>${statusText}</strong></p>
                        ${computer.customer ? `<p class="card-text">Khách: <strong>${computer.customer}</strong></p>` : ''}
                        ${computer.startTime ? `<p class="card-text">Bắt đầu: ${computer.startTime.toLocaleTimeString('vi-VN')}</p>` : ''}
                        <div class="mt-auto pt-2">${actionButton}</div>
                    </div>
                </div>
            `;
            dashboard.appendChild(card);
        });
        renderServiceQuantities();
    }

    function selectComputerForSession(computerId) {
        // Highlight the selected computer
        document.querySelectorAll('.computer-card').forEach(card => card.classList.remove('border', 'border-primary', 'border-3'));
        const selectedComputerCard = document.querySelector(`.computer-card[onclick*="${computerId}"]`).closest('.computer-card');
        if (selectedComputerCard) {
            selectedComputerCard.classList.add('border', 'border-primary', 'border-3');
        }

        // Set the computer ID for the form and open the form area
        currentComputerId = computerId;
        
        // This is a simplified approach, in a real app, you'd show a form or sidebar
        alert(`Đã chọn máy ${computers.find(c => c.id === computerId).name}. Vui lòng điền thông tin khách hàng ở sidebar bên trái và nhấn 'Bắt đầu phiên mới'.`);
    }
    
    function startSession() {
        const form = document.getElementById('bookingForm');
        if (!form.checkValidity()) {
            alert('Vui lòng điền đầy đủ và chính xác thông tin khách hàng.');
            form.reportValidity();
            return;
        }

        if (!currentComputerId) {
            alert('Vui lòng chọn một máy trống để bắt đầu phiên.');
            return;
        }

        const computer = computers.find(c => c.id === currentComputerId);
        if (computer && computer.status === 'free') {
            const fullName = document.getElementById('fullName').value || 'Khách lẻ';
            
            computer.status = 'active';
            computer.customer = fullName;
            computer.startTime = new Date();
            
            computer.servicesUsed = [];
            document.querySelectorAll('#serviceQuantities input[type="number"]').forEach(input => {
                const quantity = parseInt(input.value) || 0;
                if (quantity > 0) {
                    const serviceId = input.id.replace('service_', '');
                    computer.servicesUsed.push({ id: serviceId, quantity: quantity });
                }
            });

            const customer = customers.find(c => c.name === fullName);
            if (customer) {
                customer.lastVisit = new Date().toISOString().slice(0, 10);
                saveCustomersToLocalStorage();
            }

            renderBookingDashboard();
            alert(`Đã bắt đầu phiên mới cho máy ${computer.name}.`);
            resetBookingForm();
            currentComputerId = null; // Reset selected computer
        } else {
            alert('Máy này không thể bắt đầu phiên.');
        }
    }

    function showCheckoutModal(computerId) {
        const computer = computers.find(c => c.id === computerId);
        if (computer) {
            currentComputerId = computer.id;
            
            const endTime = new Date();
            const durationInMinutes = (endTime - computer.startTime) / (1000 * 60);
            const computerCost = (durationInMinutes / 60) * computer.price;
            
            const selectedServices = [];
            let servicesCost = 0;
            computer.servicesUsed.forEach(sUsed => {
                const service = services.find(s => s.id === sUsed.id);
                if (service) {
                    const serviceTotal = service.price * sUsed.quantity;
                    servicesCost += serviceTotal;
                    selectedServices.push({ name: service.name, price: service.price, quantity: sUsed.quantity, total: serviceTotal });
                }
            });

            const subtotal = computerCost + servicesCost;
            const total = subtotal;
            currentTotal = total; // Lưu tổng tiền vào biến toàn cục

            document.getElementById('checkoutComputerName').textContent = computer.name;
            document.getElementById('checkoutCustomerName').textContent = computer.customer;
            document.getElementById('checkoutStartTime').textContent = computer.startTime.toLocaleTimeString('vi-VN');
            document.getElementById('checkoutEndTime').textContent = endTime.toLocaleTimeString('vi-VN');
            document.getElementById('checkoutDuration').textContent = formatDuration(computer.startTime, endTime);
            document.getElementById('checkoutComputerCost').textContent = formatCurrency(computerCost);
            document.getElementById('checkoutServicesCost').textContent = formatCurrency(servicesCost);
            document.getElementById('checkoutTotal').textContent = formatCurrency(total);

            // Reset payment method selection and show cash payment details
            selectPaymentMethod('Tiền mặt');

            const modal = new bootstrap.Modal(document.getElementById('checkoutModal'));
            modal.show();
        }
    }
    
    function endSessionAndSave() {
        const computer = computers.find(c => c.id === currentComputerId);
        if (computer) {
            const endTime = new Date();
            const durationInMinutes = (endTime - computer.startTime) / (1000 * 60);
            const computerCost = (durationInMinutes / 60) * computer.price;
            
            const usedServicesData = [];
            let servicesCost = 0;
            computer.servicesUsed.forEach(sUsed => {
                const service = services.find(s => s.id === sUsed.id);
                if (service) {
                    const serviceTotal = service.price * sUsed.quantity;
                    servicesCost += serviceTotal;
                    usedServicesData.push({ name: service.name, price: service.price, quantity: sUsed.quantity, total: serviceTotal });
                }
            });

            const subtotal = computerCost + servicesCost;
            const total = subtotal;
            
            const customerId = customers.find(c => c.name === computer.customer)?.id || 'KH000';
            const phone = customers.find(c => c.name === computer.customer)?.phone || '---';

            const newTransaction = {
                id: 'GD' + String(transactions.length + 1).padStart(3, '0'),
                customerId: customerId,
                customerName: computer.customer,
                phone: phone,
                computer: `${computer.name} - ${formatCurrency(computer.price)}/giờ`,
                startTime: computer.startTime,
                endTime: endTime,
                services: usedServicesData,
                subtotal: subtotal,
                promo: 0,
                total: total,
                paymentMethod: selectedPaymentMethod // Lưu hình thức thanh toán
            };
            transactions.push(newTransaction);
            
            computer.status = 'free';
            computer.customer = '';
            computer.startTime = null;
            computer.servicesUsed = [];
            
            const modal = bootstrap.Modal.getInstance(document.getElementById('checkoutModal'));
            modal.hide();
            renderBookingDashboard();
            renderHistory();
        }
    }

    function selectPaymentMethod(method) {
        selectedPaymentMethod = method;
        document.getElementById('cashBtn').classList.remove('active');
        document.getElementById('transferBtn').classList.remove('active');
        const cashPaymentDetails = document.getElementById('cashPaymentDetails');
        
        if (method === 'Tiền mặt') {
            document.getElementById('cashBtn').classList.add('active');
            cashPaymentDetails.style.display = 'block';
            calculateChange();
        } else {
            document.getElementById('transferBtn').classList.add('active');
            cashPaymentDetails.style.display = 'none';
        }
    }

    function calculateChange() {
        const cashGiven = parseFloat(document.getElementById('cashGiven').value) || 0;
        const total = currentTotal;
        const change = cashGiven - total;
        document.getElementById('cashChange').textContent = formatCurrency(change > 0 ? change : 0);
    }


    function resetBookingForm() {
        document.getElementById('fullName').value = '';
        document.getElementById('phone').value = '';
        document.querySelectorAll('#serviceQuantities input[type="number"]').forEach(input => input.value = 0);
    }

    function renderServiceQuantities() {
        const serviceQuantitiesDiv = document.getElementById('serviceQuantities');
        serviceQuantitiesDiv.innerHTML = '';
        services.filter(s => s.status === 'active').forEach(service => {
            const quantityDiv = document.createElement('div');
            quantityDiv.className = 'd-flex align-items-center mb-2';
            quantityDiv.innerHTML = `
                <label class="form-label me-3 mb-0" for="service_${service.id}">${service.name}</label>
                <input type="number" class="form-control form-control-sm ms-auto w-25" id="service_${service.id}" min="0" value="0">
            `;
            serviceQuantitiesDiv.appendChild(quantityDiv);
        });
    }

    // --- RENDER MỚI: Dạng card cho tab Khách hàng ---
    function renderCustomers() {
        calculateAllCustomerTotalSpent();
        const customerListDiv = document.getElementById('customerList');
        customerListDiv.innerHTML = '';
        const searchTerm = document.getElementById('customerSearchInput').value.toLowerCase();
        
        const filteredCustomers = customers.filter(customer =>
            customer.name.toLowerCase().includes(searchTerm) ||
            customer.phone.toLowerCase().includes(searchTerm)
        );

        if (filteredCustomers.length === 0) {
            customerListDiv.innerHTML = '<p class="text-center text-muted">Không tìm thấy khách hàng nào.</p>';
        }

        filteredCustomers.forEach(customer => {
            const cardCol = document.createElement('div');
            cardCol.className = 'col';
            cardCol.innerHTML = `
                <div class="customer-card-item">
                    <div class="customer-card-header">
                        <h5 class="mb-0 text-primary">${customer.name}</h5>
                        <small class="text-muted">ID: ${customer.id}</small>
                    </div>
                    <div class="customer-info-row">
                        <i class="fas fa-phone-alt"></i>
                        <span>${customer.phone}</span>
                    </div>
                    <div class="customer-info-row">
                        <i class="fas fa-envelope"></i>
                        <span>${customer.email || '---'}</span>
                    </div>
                    <div class="customer-card-footer">
                        <div class="d-flex flex-column align-items-center me-3">
                            <small class="text-muted">Tổng chi tiêu</small>
                            <h6 class="mb-0 text-success">${formatCurrency(customer.totalSpent)}</h6>
                        </div>
                        <div class="d-flex">
                            <button class="btn btn-sm btn-warning me-2" onclick="editCustomer('${customer.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteCustomer('${customer.id}')">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            customerListDiv.appendChild(cardCol);
        });
    }

    function filterCustomers() {
        renderCustomers();
    }

    // --- Cập nhật render chức năng mới cho Máy tính ---
    function renderComputers() {
        const tableBody = document.getElementById('computerTable');
        tableBody.innerHTML = '';
        const filterValue = document.getElementById('computerStatusFilter').value;

        const filteredComputers = computers.filter(computer =>
            filterValue === 'all' || computer.status === filterValue
        );
        
        filteredComputers.forEach(computer => {
            const statusClass = `status-${computer.status}`;
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${computer.id}</td>
                <td>${computer.name}</td>
                <td>${formatCurrency(computer.price)}/giờ</td>
                <td><span class="badge ${getStatusBadgeClass(computer.status)}">${getStatusText(computer.status)}</span></td>
                <td>${computer.customer || '---'}</td>
                <td>${computer.startTime ? computer.startTime.toLocaleTimeString('vi-VN') : '---'}</td>
                <td>
                    <button class="btn btn-warning btn-sm me-2" onclick="editComputer('${computer.id}')">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-danger btn-sm" onclick="deleteComputer('${computer.id}')">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </td>
            `;
            tableBody.appendChild(row);
        });
    }

    function filterComputers() {
        renderComputers();
    }

    function getStatusText(status) {
        switch(status) {
            case 'active': return 'Đang hoạt động';
            case 'maintenance': return 'Bảo trì';
            case 'broken': return 'Hỏng';
            default: return 'Trống';
        }
    }
    
    function getStatusBadgeClass(status) {
        switch(status) {
            case 'active': return 'bg-success';
            case 'maintenance': return 'bg-warning';
            case 'broken': return 'bg-danger';
            default: return 'bg-secondary';
        }
    }

    // --- Cập nhật render chức năng mới cho Dịch vụ ---
    function renderServices() {
        const tableBody = document.getElementById('serviceTable');
        tableBody.innerHTML = '';
        const searchTerm = document.getElementById('serviceSearchInput').value.toLowerCase();

        const filteredServices = services.filter(service =>
            service.name.toLowerCase().includes(searchTerm)
        );

        filteredServices.forEach(service => {
            const statusClass = service.status === 'active' ? 'bg-success' : 'bg-danger';
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${service.name}</td>
                <td>${formatCurrency(service.price)}</td>
                <td><span class="badge ${statusClass}">${service.status === 'active' ? 'Hoạt động' : 'Ngừng bán'}</span></td>
                <td>
                    <button class="btn btn-warning btn-sm me-2" onclick="editService('${service.id}')">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-danger btn-sm" onclick="deleteService('${service.id}')">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </td>
            `;
            tableBody.appendChild(row);
        });
    }

    function filterServices() {
        renderServices();
    }

    // --- Cập nhật render chức năng mới cho Lịch sử ---
    function renderHistory() {
        const tableBody = document.getElementById('historyTable');
        tableBody.innerHTML = '';
        const searchTerm = document.getElementById('historySearchInput').value.toLowerCase();
        const dateFilter = document.getElementById('historyDateFilter').value;

        const filteredTransactions = transactions.filter(transaction => {
            const matchesSearch = transaction.customerName.toLowerCase().includes(searchTerm) || transaction.id.toLowerCase().includes(searchTerm);
            const matchesDate = !dateFilter || transaction.startTime.toISOString().slice(0, 10) === dateFilter;
            return matchesSearch && matchesDate;
        });

        filteredTransactions.forEach(transaction => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${transaction.id}</td>
                <td>${transaction.startTime.toLocaleDateString('vi-VN')}</td>
                <td>${transaction.customerName}</td>
                <td>${transaction.computer.split('-')[0].trim()}</td>
                <td>${formatCurrency(transaction.total)}</td>
                <td>${transaction.paymentMethod}</td>
                <td>
                    <button class="btn btn-info btn-sm" data-bs-toggle="modal" data-bs-target="#viewTransactionModal" onclick="viewTransaction('${transaction.id}')">
                        <i class="fas fa-eye"></i>
                    </button>
                </td>
            `;
            tableBody.appendChild(row);
        });
    }

    function filterHistory() {
        renderHistory();
    }

    // --- Cập nhật render chức năng mới cho Games ---
    function renderGames() {
        const gameList = document.getElementById('gameList');
        const softwareList = document.getElementById('softwareList');
        gameList.innerHTML = '';
        softwareList.innerHTML = '';
        const filterValue = document.getElementById('gameSoftwareFilter').value;

        const filteredGames = games.filter(item =>
            filterValue === 'all' || item.type === filterValue
        );

        filteredGames.forEach(item => {
            const li = document.createElement('li');
            li.className = 'list-group-item d-flex justify-content-between align-items-center bg-light';
            li.innerHTML = `
                <span><i class="fas fa-${item.type === 'game' ? 'gamepad' : 'laptop'} me-2"></i>${item.name}</span>
                <span class="d-flex align-items-center">
                    <span class="badge bg-primary me-2">${item.category || '---'}</span>
                    <button class="btn btn-danger btn-sm" onclick="deleteGame('${item.id}')">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </span>
            `;
            if (item.type === 'game') {
                gameList.appendChild(li);
            } else {
                softwareList.appendChild(li);
            }
        });
    }

    function filterGames() {
        renderGames();
    }
    
    // --- Cập nhật render chức năng mới cho Thống kê ---
    function renderStatistics() {
        const totalRevenue = transactions.reduce((sum, t) => sum + t.total, 0);
        const totalCustomers = customers.length;
        const activeComputers = computers.filter(c => c.status === 'active').length;
        const totalComputers = computers.length;

        const serviceCounts = {};
        transactions.forEach(t => {
            if (t.services) {
                t.services.forEach(s => {
                    serviceCounts[s.name] = (serviceCounts[s.name] || 0) + s.quantity;
                });
            }
        });
        const mostPopularService = Object.keys(serviceCounts).reduce((a, b) => (serviceCounts[a] > serviceCounts[b] ? a : b), 'Chưa có');

        document.getElementById('totalRevenue').textContent = formatCurrency(totalRevenue);
        document.getElementById('totalCustomers').textContent = totalCustomers;
        document.getElementById('activeComputers').textContent = `${activeComputers}/${totalComputers}`;
        document.getElementById('mostPopularService').textContent = mostPopularService;

        renderMonthlyRevenueChart();
    }

    function renderMonthlyRevenueChart() {
        const chartDiv = document.getElementById('monthlyRevenueChart');
        chartDiv.innerHTML = '';

        const monthlyRevenue = {};
        transactions.forEach(t => {
            const month = t.startTime.getMonth();
            const year = t.startTime.getFullYear();
            const key = `${month}-${year}`;
            monthlyRevenue[key] = (monthlyRevenue[key] || 0) + t.total;
        });

        const now = new Date();
        const revenueData = [];
        for (let i = 0; i < 6; i++) {
            const date = new Date(now.getFullYear(), now.getMonth() - i, 1);
            const key = `${date.getMonth()}-${date.getFullYear()}`;
            revenueData.unshift({
                month: date.getMonth() + 1,
                year: date.getFullYear(),
                revenue: monthlyRevenue[key] || 0
            });
        }
        
        const maxRevenue = Math.max(...revenueData.map(d => d.revenue));

        revenueData.forEach(data => {
            const barHeight = maxRevenue > 0 ? (data.revenue / maxRevenue) * 100 : 0;
            const bar = document.createElement('div');
            bar.className = 'd-flex flex-column align-items-center me-3';
            bar.style.width = '10%';
            bar.innerHTML = `
                <div class="bg-primary" style="height: ${barHeight}%; width: 50%; border-radius: 5px;"></div>
                <small class="mt-2 text-center text-muted">${data.month}/${data.year}</small>
                <small class="text-center text-muted">${formatCurrency(data.revenue)}</small>
            `;
            chartDiv.appendChild(bar);
        });
    }

    // Customer functions
    function addCustomer(event) {
        event.preventDefault();
        const newCustomerName = document.getElementById('newCustomerName').value;
        const newCustomerPhone = document.getElementById('newCustomerPhone').value;
        const newCustomerEmail = document.getElementById('newCustomerEmail').value;
        const newId = 'KH' + String(customers.length + 1).padStart(3, '0');
        customers.push({
            id: newId,
            name: newCustomerName,
            phone: newCustomerPhone,
            email: newCustomerEmail,
            lastVisit: '',
            totalSpent: 0
        });
        saveCustomersToLocalStorage();
        renderCustomers();
        const modal = bootstrap.Modal.getInstance(document.getElementById('addCustomerModal'));
        modal.hide();
        document.getElementById('newCustomerForm').reset();
    }

    function editCustomer(id) {
        editingCustomerId = id;
        const customer = customers.find(c => c.id === id);
        if (customer) {
            document.getElementById('editCustomerId').value = customer.id;
            document.getElementById('editCustomerName').value = customer.name;
            document.getElementById('editCustomerPhone').value = customer.phone;
            document.getElementById('editCustomerEmail').value = customer.email;
            const modal = new bootstrap.Modal(document.getElementById('editCustomerModal'));
            modal.show();
        }
    }

    function updateCustomer(event) {
        event.preventDefault();
        const customer = customers.find(c => c.id === editingCustomerId);
        if (customer) {
            customer.name = document.getElementById('editCustomerName').value;
            customer.phone = document.getElementById('editCustomerPhone').value;
            customer.email = document.getElementById('editCustomerEmail').value;
            saveCustomersToLocalStorage();
            renderCustomers();
            const modal = bootstrap.Modal.getInstance(document.getElementById('editCustomerModal'));
            modal.hide();
        }
    }

    function deleteCustomer(id) {
        if (confirm('Bạn có chắc chắn muốn xóa khách hàng này không?')) {
            customers = customers.filter(c => c.id !== id);
            saveCustomersToLocalStorage();
            renderCustomers();
        }
    }
    
    // Computer functions
    function addComputer(event) {
        event.preventDefault();
        const newComputerName = document.getElementById('newComputerName').value;
        const newComputerPrice = parseFloat(document.getElementById('newComputerPrice').value);
        const newComputerStatus = document.getElementById('newComputerStatus').value;
        const newId = 'MAY' + String(computers.length + 1).padStart(3, '0');
        computers.push({
            id: newId,
            name: newComputerName,
            price: newComputerPrice,
            status: newComputerStatus,
            customer: '',
            startTime: null,
            servicesUsed: []
        });
        renderComputers();
        renderBookingDashboard();
        const modal = bootstrap.Modal.getInstance(document.getElementById('addComputerModal'));
        modal.hide();
        document.getElementById('newComputerForm').reset();
    }

    function editComputer(id) {
        editingComputerId = id;
        const computer = computers.find(c => c.id === id);
        if (computer) {
            document.getElementById('editComputerId').value = computer.id;
            document.getElementById('editComputerName').value = computer.name;
            document.getElementById('editComputerPrice').value = computer.price;
            document.getElementById('editComputerStatus').value = computer.status;
            const modal = new bootstrap.Modal(document.getElementById('editComputerModal'));
            modal.show();
        }
    }

    function updateComputer(event) {
        event.preventDefault();
        const computer = computers.find(c => c.id === editingComputerId);
        if (computer) {
            computer.name = document.getElementById('editComputerName').value;
            computer.price = parseFloat(document.getElementById('editComputerPrice').value);
            computer.status = document.getElementById('editComputerStatus').value;
            renderComputers();
            renderBookingDashboard();
            const modal = bootstrap.Modal.getInstance(document.getElementById('editComputerModal'));
            modal.hide();
        }
    }

    function deleteComputer(id) {
        if (confirm('Bạn có chắc chắn muốn xóa máy tính này không?')) {
            computers = computers.filter(c => c.id !== id);
            renderComputers();
            renderBookingDashboard();
        }
    }

    // Service functions
    function addService(event) {
        event.preventDefault();
        const newServiceName = document.getElementById('newServiceName').value;
        const newServicePrice = parseFloat(document.getElementById('newServicePrice').value);
        const newServiceStatus = document.getElementById('newServiceStatus').value;
        const newId = 'DV' + String(services.length + 1).padStart(3, '0');
        services.push({
            id: newId,
            name: newServiceName,
            price: newServicePrice,
            status: newServiceStatus
        });
        renderServices();
        renderBookingDashboard();
        const modal = bootstrap.Modal.getInstance(document.getElementById('addServiceModal'));
        modal.hide();
        document.getElementById('newServiceForm').reset();
    }

    function editService(id) {
        editingServiceId = id;
        const service = services.find(s => s.id === id);
        if (service) {
            document.getElementById('editServiceId').value = service.id;
            document.getElementById('editServiceName').value = service.name;
            document.getElementById('editServicePrice').value = service.price;
            document.getElementById('editServiceStatus').value = service.status;
            const modal = new bootstrap.Modal(document.getElementById('editServiceModal'));
            modal.show();
        }
    }

    function updateService(event) {
        event.preventDefault();
        const service = services.find(s => s.id === editingServiceId);
        if (service) {
            service.name = document.getElementById('editServiceName').value;
            service.price = parseFloat(document.getElementById('editServicePrice').value);
            service.status = document.getElementById('editServiceStatus').value;
            renderServices();
            renderBookingDashboard();
            const modal = bootstrap.Modal.getInstance(document.getElementById('editServiceModal'));
            modal.hide();
        }
    }
    
    function deleteService(id) {
        if (confirm('Bạn có chắc chắn muốn xóa dịch vụ này không?')) {
            services = services.filter(s => s.id !== id);
            renderServices();
            renderBookingDashboard();
        }
    }

    // History functions
    function viewTransaction(id) {
        const transaction = transactions.find(t => t.id === id);
        if (transaction) {
            document.getElementById('viewTransactionId').textContent = transaction.id;
            document.getElementById('viewTransactionCustomer').textContent = transaction.customerName;
            document.getElementById('viewTransactionPhone').textContent = transaction.phone;
            document.getElementById('viewTransactionComputer').textContent = transaction.computer;
            document.getElementById('viewTransactionDate').textContent = transaction.startTime.toLocaleDateString('vi-VN');
            document.getElementById('viewTransactionTime').textContent = `${transaction.startTime.toLocaleTimeString('vi-VN')} - ${transaction.endTime.toLocaleTimeString('vi-VN')}`;
            document.getElementById('viewTransactionDuration').textContent = formatDuration(transaction.startTime, transaction.endTime);

            const viewServicesDiv = document.getElementById('viewTransactionServices');
            viewServicesDiv.innerHTML = '';
            if (transaction.services && transaction.services.length > 0) {
                transaction.services.forEach(s => {
                    const serviceItem = document.createElement('div');
                    serviceItem.className = 'd-flex justify-content-between';
                    serviceItem.innerHTML = `<span>${s.name} x${s.quantity}</span><span>${formatCurrency(s.total)}</span>`;
                    viewServicesDiv.appendChild(serviceItem);
                });
            } else {
                viewServicesDiv.innerHTML = 'Không có dịch vụ';
            }
            
            document.getElementById('viewTransactionSubtotal').textContent = formatCurrency(transaction.subtotal);
            document.getElementById('viewTransactionPromo').textContent = formatCurrency(transaction.promo);
            document.getElementById('viewTransactionTotal').textContent = formatCurrency(transaction.total);
            document.getElementById('viewTransactionPaymentMethod').textContent = transaction.paymentMethod;
            
            document.getElementById('printTransactionBtn').onclick = () => {
                const receiptContent = document.getElementById('receiptModalBody').innerHTML;
                const printWindow = window.open('', '', 'height=600,width=800');
                printWindow.document.write('<html><head><title>Hóa đơn</title>');
                printWindow.document.write('<style>@media print { body { visibility: visible; } .no-print { display: none; } }</style>');
                printWindow.document.write('</head><body>');
                printWindow.document.write(receiptContent);
                printWindow.document.write('</body></html>');
                printWindow.document.close();
                printWindow.focus();
                printWindow.print();
            };
        }
    }
    
    // Game functions
    function addGame(event) {
        event.preventDefault();
        const newGameName = document.getElementById('newGameName').value;
        const newGameType = document.getElementById('newGameType').value;
        const newGameCategory = document.getElementById('newGameCategory').value;
        const newId = (newGameType === 'game' ? 'GAME' : 'SOFT') + String(games.length + 1).padStart(3, '0');
        games.push({
            id: newId,
            name: newGameName,
            category: newGameCategory,
            type: newGameType
        });
        renderGames();
        const modal = bootstrap.Modal.getInstance(document.getElementById('addGameModal'));
        modal.hide();
        document.getElementById('newGameForm').reset();
    }
    
    function deleteGame(id) {
        if (confirm('Bạn có chắc chắn muốn xóa game/phần mềm này không?')) {
            games = games.filter(g => g.id !== id);
            renderGames();
        }
    }
    
    // Thêm hàm để cập nhật lại tất cả các tab khi chuyển tab
    function updateAllTabs() {
        renderBookingDashboard();
        renderCustomers();
        renderComputers();
        renderServices();
        renderHistory();
        renderGames();
        renderStatistics();
    }

    // Initialize data on page load
    document.addEventListener('DOMContentLoaded', () => {
        loadCustomersFromLocalStorage();
        updateAllTabs();
        
        // Thêm event listener cho các tab
        const tabs = document.querySelectorAll('.nav-tabs a');
        tabs.forEach(tab => {
            tab.addEventListener('shown.bs.tab', () => {
                const activeTabId = document.querySelector('.tab-pane.fade.show.active').getAttribute('id');
                switch (activeTabId) {
                    case 'booking':
                        renderBookingDashboard();
                        break;
                    case 'customer':
                        renderCustomers();
                        break;
                    case 'computer':
                        renderComputers();
                        break;
                    case 'service':
                        renderServices();
                        break;
                    case 'history':
                        renderHistory();
                        break;
                    case 'statistics':
                        renderStatistics();
                        break;
                    case 'games':
                        renderGames();
                        break;
                }
            });
        });
    });
</script>

</body>
</html>